PROTOCOL

Kryon speaks 9P2000 with Marrow.  All UI state is a filesystem mounted at /mnt/wm.

WINDOW MANAGER HIERARCHY

Kryon provides a window manager interface at /mnt/wm:

    /mnt/wm/                         Window manager service
    ├── ctl                          Create windows (write JSON)
    ├── version                      "Kryon 1.0"
    └── windows/                     All windows
        ├── 1/                      Window 1
        │   ├── title               Window title (file)
        │   ├── rect                Position "x,y,w,h" (file)
        │   ├── visible             "true" or "false" (file)
        │   ├── focused             "true" or "false" (file)
        │   ├── widgets/            Widget tree
        │   │   └── [id]/
        │   │       ├── type        Widget type (button, label, etc.)
        │   │       ├── properties/ Widget properties (files)
        │   │       │   ├── text
        │   │       │   ├── color
        │   │       │   ├── x
        │   │       │   ├── y
        │   │       │   ├── width
        │   │       │   └── height
        │   │       └── events      Read events (file)
        │   └── events              Window events (read-only)
        └── 2/                      Window 2

CONTROL INTERFACE

Create window (write JSON to /mnt/wm/ctl):

    echo '{"title":"My Window","width":800,"height":600}' > /mnt/wm/ctl

Response: Window ID (e.g., "1")

Window properties (read/write files):

    /mnt/wm/windows/1/title          "My Window"
    /mnt/wm/windows/1/rect           "100,100,800,600"
    /mnt/wm/windows/1/visible        "true"
    /mnt/wm/windows/1/focused        "false"

Widget management:

    # Create widget (write to new file in widgets/)
    echo "type=button" > /mnt/wm/windows/1/widgets/new

    # Set properties (write to property files)
    echo "Click Me" > /mnt/wm/windows/1/widgets/1/properties/text
    echo "#ff0000" > /mnt/wm/windows/1/widgets/1/properties/color

    # Read events
    cat /mnt/wm/windows/1/widgets/1/events
    # Output: clicked x=50 y=20 button=1

EVENT FORMAT

Events are read from event files (one line per event):

    clicked x=50 y=20 button=1
    changed value="new text"
    mouse_enter x=10 y=10
    mouse_leave
    focus_gained
    focus_lost
    key_press key=Enter
    key_release key=Escape

WIDGET TYPES

Kryon supports 89 widget types:

    Input: button, checkbox, radio, textbox, password, textarea,
           slider, progress, spinner, combobox, list, tree, table,
           menu, toolbar, scrollbar, etc.

    Display: label, image, icon, progress, separator, frame,
              chart, graph, tooltip

    Container: box, hbox, vbox, grid, frame, dialog, panel,
               scroll, tab, split, deck

    Navigation: menubar, menu, tabbar, breadcrumb

    Form: form, field, label, input, button, submit, validation

    Layout: absolute, relative, flow, flex, grid

    Specialized: terminal, editor, console, filepicker, calendar,
                clock, map, imageviewer, mediaplayer, webview,
                pdfviewer, notification, dialog, wizard

PERMISSIONS

    /mnt/wm/version          0444    read-only
    /mnt/wm/ctl              0222    write-only
    /mnt/wm/windows/         0755    listable
    /mnt/wm/windows/*/title  0644    read/write
    /mnt/wm/windows/*/rect   0644    read/write
    /mnt/wm/windows/*/events 0444    read-only
    /mnt/wm/windows/*/widgets/   0755 listable
    /mnt/wm/windows/*/widgets/*/properties/ 0755 read/write

ERROR CODES

    EPERM           Operation not permitted
    ENOENT          File not found
    EEXIST          File exists
    EINVAL          Invalid argument
    EOUTOFRANGE     Value out of range
    ENOSPACE        No space (max widgets reached)
    ENOTSUPPORTED   Operation not supported
    ENOMEMORY       Out of memory
