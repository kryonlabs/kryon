# Kryon-C Code Formatting Configuration
# Based on LLVM style with Kryon-specific customizations

BasedOnStyle: LLVM

# =============================================================================
# BASIC FORMATTING
# =============================================================================

# Indentation
IndentWidth: 4
TabWidth: 4
UseTab: Never
ContinuationIndentWidth: 4
IndentCaseLabels: true
IndentGotoLabels: true
IndentPPDirectives: AfterHash

# Line length and breaking
ColumnLimit: 100
ReflowComments: true
BreakBeforeBinaryOperators: NonAssignment
BreakBeforeConditionalOperators: true
BreakBeforeTernaryOperators: true

# =============================================================================
# BRACES AND SPACING
# =============================================================================

# Brace placement
BreakBeforeBraces: Attach
BraceWrapping:
  AfterClass: false
  AfterControlStatement: false
  AfterEnum: false
  AfterFunction: false
  AfterNamespace: false
  AfterStruct: false
  AfterUnion: false
  BeforeCatch: false
  BeforeElse: false
  IndentBraces: false

# Spacing
SpaceAfterCStyleCast: true
SpaceAfterLogicalNot: false
SpaceAfterTemplateKeyword: true
SpaceBeforeAssignmentOperators: true
SpaceBeforeCaseColon: false
SpaceBeforeCtorInitializerColon: true
SpaceBeforeInheritanceColon: true
SpaceBeforeParens: ControlStatements
SpaceBeforeRangeBasedForLoopColon: true
SpaceInEmptyBlock: false
SpaceInEmptyParentheses: false
SpacesBeforeTrailingComments: 2
SpacesInAngles: false
SpacesInContainerLiterals: true
SpacesInCStyleCastParentheses: false
SpacesInParentheses: false
SpacesInSquareBrackets: false

# =============================================================================
# ALIGNMENT
# =============================================================================

# Alignment options
AlignAfterOpenBracket: Align
AlignArrayOfStructures: Right
AlignConsecutiveAssignments: false
AlignConsecutiveDeclarations: false
AlignConsecutiveMacros: false
AlignEscapedNewlines: Right
AlignOperands: Align
AlignTrailingComments: true

# Pointer and reference alignment
PointerAlignment: Right
ReferenceAlignment: Right
DerivePointerAlignment: false

# =============================================================================
# FUNCTION AND PARAMETER FORMATTING
# =============================================================================

# Function formatting
AllowShortFunctionsOnASingleLine: Inline
AllowShortIfStatementsOnASingleLine: Never
AllowShortLoopsOnASingleLine: false
AllowShortCaseLabelsOnASingleLine: false
AllowShortBlocksOnASingleLine: Empty

# Parameter and argument formatting
AllowAllParametersOfDeclarationOnNextLine: false
AllowAllArgumentsOnNextLine: false
BinPackArguments: false
BinPackParameters: false

# =============================================================================
# INCLUDES AND SORTING
# =============================================================================

# Include sorting
SortIncludes: CaseInsensitive
IncludeBlocks: Regroup
IncludeCategories:
  # System headers
  - Regex: '<[[:alnum:]_]+>'
    Priority: 1
  # System headers with extension
  - Regex: '<[[:alnum:]_]+\.[[:alnum:]]+>'
    Priority: 2
  # Third-party libraries
  - Regex: '<(lua|quickjs|stb|raylib|cjson)/.*>'
    Priority: 3
  # Kryon public headers
  - Regex: '<kryon/.*>'
    Priority: 4
  # Kryon internal headers
  - Regex: '"internal/.*"'
    Priority: 5
  # Local headers
  - Regex: '".*"'
    Priority: 6

# =============================================================================
# COMMENTS AND DOCUMENTATION
# =============================================================================

# Comment formatting
ReflowComments: true
CommentPragmas: '^ IWYU pragma:'

# Keep block comments aligned
AlignTrailingComments: true
SpacesBeforeTrailingComments: 2

# =============================================================================
# LANGUAGE-SPECIFIC SETTINGS
# =============================================================================

# C-specific settings
Standard: c99
Cpp11BracedListStyle: false

# Macro formatting
IndentPPDirectives: AfterHash
MacroBlockBegin: '^KRYON_BEGIN_'
MacroBlockEnd: '^KRYON_END_'

# =============================================================================
# CUSTOM KRYON FORMATTING
# =============================================================================

# Custom patterns for Kryon code
# (These would be specific to our coding style)

# Keep certain patterns intact
# For example, keep logging macros on one line when possible
AttributeMacros: ['KRYON_API', 'KRYON_INTERNAL', 'KRYON_DEPRECATED']

# Penalties for breaking formatting rules
PenaltyBreakAssignment: 2
PenaltyBreakBeforeFirstCallParameter: 1
PenaltyBreakComment: 300
PenaltyBreakFirstLessLess: 120
PenaltyBreakString: 1000
PenaltyBreakTemplateDeclaration: 10
PenaltyExcessCharacter: 1000000
PenaltyReturnTypeOnItsOwnLine: 200

# =============================================================================
# FINAL SETTINGS
# =============================================================================

# Misc settings
KeepEmptyLinesAtTheStartOfBlocks: false
MaxEmptyLinesToKeep: 2
InsertTrailingCommas: None
RemoveBracesLLVM: false
SeparateDefinitionBlocks: Always