CONTROLLER API

Kryon provides multiple ways to interact with the window manager filesystem.

C API (via 9P client library):

    #include <p9client.h>
    #include <kryon.h>

    // Connect to 9P server (Marrow)
    P9Client *p9 = p9_connect("tcp!localhost!17010");
    p9_authenticate(p9, P9_AUTH_NONE, "none", "");

    // Register as window-manager service
    p9_service_register(p9, "kryon", "window-manager",
                       "Kryon Window Manager");

    // Mount /mnt/wm to Marrow's namespace
    p9_namespace_mount(p9, "/mnt/wm");

    // Open /dev/draw for rendering
    // (via graphics.h - not shown here)

    // Create window via filesystem
    int ctl_fd = p9_open(p9, "/mnt/wm/ctl", P9_OWRITE);
    p9_write(p9, ctl_fd, "{\"title\":\"My Window\",\"width\":800,\"height\":600}", 40);
    p9_close(p9, ctl_fd);

    // Set properties
    int title_fd = p9_open(p9, "/mnt/wm/windows/1/title", P9_OWRITE);
    p9_write(p9, title_fd, "New Title", 10);
    p9_close(p9, title_fd);

    // Event loop
    int event_fd = p9_open(p9, "/mnt/wm/windows/1/events", P9_OREAD);
    char buf[256];
    while (p9_read(p9, event_fd, buf, sizeof(buf)) > 0) {
        printf("Event: %s\n", buf);
    }

Shell (rc) scripting:

    # Create window (via Marrow namespace)
    echo '{"title":"My Window","width":800,"height":600}' > /mnt/wm/ctl

    # Set title
    echo "New Title" > /mnt/wm/windows/1/title

    # Create button widget
    echo "type=button" > /mnt/wm/windows/1/widgets/new

    # Set button text
    echo "Click Me" > /mnt/wm/windows/1/widgets/1/properties/text

    # Event loop
    while () {
        event=`{cat /mnt/wm/windows/1/widgets/1/events}
        if (~ $event()) {
            echo Button clicked!
        }
    }

Python (via 9p client to Marrow):

    import p9

    # Connect to Marrow
    marrow = p9.mount("tcp!localhost!17010", "")

    # Access Kryon's /mnt/wm
    wm = marrow.cd("/mnt/wm")

    # Create window
    wm.ctl.write('{"title":"My Window","width":800,"height":600}')

    # Set title
    marrow.write("/mnt/wm/windows/1/title", "New Title")

    # Create button
    marrow.write("/mnt/wm/windows/1/widgets/new", "type=button")

    # Set text
    marrow.write("/mnt/wm/windows/1/widgets/1/properties/text", "Click Me")

    # Event loop
    for event in marrow.events("/mnt/wm/windows/1/widgets/1/events"):
        if "clicked" in event:
            print("Clicked!")

Lua (via 9p client to Marrow):

    local p9 = require("9p")

    -- Connect to Marrow
    local marrow = p9.connect("tcp!localhost!17010")

    -- Access Kryon's /mnt/wm
    local wm = marrow:cd("/mnt/wm")

    -- Create window
    wm:ctl_write('{"title":"My Window","width":800,"height":600}')

    -- Set title
    marrow:write("/mnt/wm/windows/1/title", "New Title")

    -- Create button
    marrow:write("/mnt/wm/windows/1/widgets/new", "type=button")

    -- Set text
    marrow:write("/mnt/wm/windows/1/widgets/1/properties/text", "Click Me")

    -- Event loop
    for event in marrow:events("/mnt/wm/windows/1/widgets/1/events") do
        if event:find("clicked") then
            print("Clicked!")
        end
    end

NOTES:

- All operations go through Marrow on port 17010
- /dev/draw is used for rendering (provided by Marrow)
- /mnt/wm is provided by Kryon service
- Window and widget properties are files in /mnt/wm
- Events are read from event files
