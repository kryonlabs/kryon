#ifndef IR_HTML_AST_H
#define IR_HTML_AST_H

#include <stdint.h>
#include <stdbool.h>
#include <stddef.h>

// HTML AST - Lightweight HTML parser for Kryon transpilation roundtrip
// Parses ONLY the HTML generated by html_generator.c (not arbitrary HTML)

typedef enum {
    HTML_NODE_ELEMENT,    // Tag-based elements (<h1>, <div>, <ul>, etc.)
    HTML_NODE_TEXT,       // Text content nodes
    HTML_NODE_COMMENT,    // <!-- comments --> (usually ignored)
} HtmlNodeType;

// HTML AST node structure
typedef struct HtmlNode {
    HtmlNodeType type;

    // Element properties
    char* tag_name;           // "h1", "div", "ul", etc. (NULL for text nodes)
    char* text_content;       // Text content (for TEXT nodes or element text)

    // Standard HTML attributes
    char* id;                 // id attribute
    char* class_name;         // class attribute
    char* style;              // style attribute (inline CSS)

    // Element-specific attributes
    char* src;                // <img>, <iframe> src
    char* href;               // <a> href
    char* target;             // <a> target (_blank, _self, etc.)
    char* rel;                // <a> rel (noopener, noreferrer, etc.)
    char* alt;                // <img> alt text
    char* input_type;         // <input> type attribute
    char* value;              // <input> value
    bool checked;             // <input type="checkbox"> checked state
    uint32_t start;           // <ol> start attribute

    // Data attributes (for roundtrip metadata)
    char* data_ir_type;       // data-ir-type: Component type (HEADING, LIST, etc.)
    uint32_t data_ir_id;      // data-ir-id: Original component ID
    uint32_t data_level;      // data-level: Heading level (1-6)
    char* data_list_type;     // data-list-type: ordered/unordered
    bool data_checked;        // data-checked: Checkbox state
    char* data_value;         // data-value: Input value

    // Tree structure
    struct HtmlNode* parent;
    struct HtmlNode** children;
    uint32_t child_count;
    uint32_t child_capacity;  // Allocated capacity for children array

    // Inline formatting flags (for text nodes within paragraphs)
    bool is_bold;             // Wrapped in <strong> or <b>
    bool is_italic;           // Wrapped in <em> or <i>
    bool is_code;             // Wrapped in <code>
    bool is_link;             // Wrapped in <a>
    char* link_url;           // URL if is_link is true
} HtmlNode;

// ============================================================================
// HTML AST API
// ============================================================================

// Create a new HTML node
HtmlNode* html_node_create(HtmlNodeType type);

// Create an element node with tag name
HtmlNode* html_node_create_element(const char* tag_name);

// Create a text node with content
HtmlNode* html_node_create_text(const char* text);

// Add a child node to a parent
void html_node_add_child(HtmlNode* parent, HtmlNode* child);

// Set attribute on a node
void html_node_set_attribute(HtmlNode* node, const char* name, const char* value);

// Get attribute from a node (returns NULL if not found)
const char* html_node_get_attribute(HtmlNode* node, const char* name);

// Set data-* attribute
void html_node_set_data_attribute(HtmlNode* node, const char* name, const char* value);

// Free HTML AST tree recursively
void html_node_free(HtmlNode* node);

// Clone HTML node (shallow copy, no children)
HtmlNode* html_node_clone(const HtmlNode* node);

// Print HTML AST tree for debugging
void html_node_print(const HtmlNode* node, int indent);

#endif // IR_HTML_AST_H
