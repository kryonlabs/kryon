{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TKIR - Toolkit Intermediate Representation",
  "description": "Intermediate representation between KIR and toolkit-based codegens",
  "type": "object",
  "required": ["format", "version", "window", "widgets"],
  "properties": {
    "format": {
      "type": "string",
      "const": "tkir",
      "description": "Format identifier, always 'tkir'"
    },
    "version": {
      "type": "string",
      "description": "TKIR version (e.g., 'alpha')"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "source_kir": {
          "type": "string",
          "description": "Path to source KIR file"
        },
        "generator": {
          "type": "string",
          "description": "Generator name (e.g., 'kryon-tkir-generator')"
        }
      }
    },
    "window": {
      "type": "object",
      "required": ["title", "width", "height"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Window title"
        },
        "width": {
          "type": "integer",
          "minimum": 1,
          "description": "Window width in pixels"
        },
        "height": {
          "type": "integer",
          "minimum": 1,
          "description": "Window height in pixels"
        },
        "resizable": {
          "type": "boolean",
          "description": "Whether window is resizable"
        },
        "background": {
          "type": "string",
          "pattern": "^#[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$|^transparent$",
          "description": "Window background color (hex or 'transparent')"
        }
      }
    },
    "widgets": {
      "type": "array",
      "description": "Array of all widgets in the UI",
      "items": {
        "$ref": "#/definitions/widget"
      }
    },
    "handlers": {
      "type": "array",
      "description": "Array of event handlers",
      "items": {
        "$ref": "#/definitions/handler"
      }
    },
    "data_bindings": {
      "type": "array",
      "description": "Array of data binding definitions",
      "items": {
        "$ref": "#/definitions/data_binding"
      }
    }
  },
  "definitions": {
    "widget": {
      "type": "object",
      "required": ["id", "tk_type", "properties"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique widget identifier"
        },
        "tk_type": {
          "type": "string",
          "description": "Tk widget type (button, label, frame, etc.)"
        },
        "kir_type": {
          "type": "string",
          "description": "Original KIR component type"
        },
        "properties": {
          "type": "object",
          "properties": {
            "text": {
              "type": "string",
              "description": "Text content"
            },
            "background": {
              "type": "string",
              "description": "Background color (resolved, inherited)"
            },
            "foreground": {
              "type": "string",
              "description": "Foreground/text color"
            },
            "image": {
              "type": "string",
              "description": "Image path"
            },
            "width": {
              "$ref": "#/definitions/size"
            },
            "height": {
              "$ref": "#/definitions/size"
            },
            "font": {
              "$ref": "#/definitions/font"
            },
            "border": {
              "$ref": "#/definitions/border"
            }
          }
        },
        "layout": {
          "$ref": "#/definitions/layout"
        },
        "children": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Child widget ID references"
          },
          "description": "Array of child widget IDs"
        },
        "events": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Handler ID references"
          },
          "description": "Array of event handler IDs"
        }
      }
    },
    "size": {
      "type": "object",
      "required": ["value"],
      "properties": {
        "value": {
          "type": "number",
          "description": "Size value"
        },
        "unit": {
          "type": "string",
          "enum": ["px", "%", "em", "pt"],
          "description": "Size unit"
        }
      }
    },
    "font": {
      "type": "object",
      "properties": {
        "family": {
          "type": "string",
          "description": "Font family name"
        },
        "size": {
          "type": "number",
          "description": "Font size"
        },
        "size_unit": {
          "type": "string",
          "enum": ["px", "pt", "em"],
          "description": "Font size unit"
        },
        "weight": {
          "type": "string",
          "enum": ["normal", "bold", "light", "100", "200", "300", "400", "500", "600", "700", "800", "900"],
          "description": "Font weight"
        },
        "style": {
          "type": "string",
          "enum": ["normal", "italic", "oblique"],
          "description": "Font style"
        }
      }
    },
    "border": {
      "type": "object",
      "properties": {
        "width": {
          "type": "integer",
          "minimum": 0,
          "description": "Border width in pixels"
        },
        "color": {
          "type": "string",
          "pattern": "^#[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$",
          "description": "Border color (hex)"
        },
        "style": {
          "type": "string",
          "enum": ["solid", "dashed", "dotted", "double", "groove", "ridge", "inset", "outset"],
          "description": "Border style"
        }
      }
    },
    "layout": {
      "type": "object",
      "required": ["type", "options"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["pack", "grid", "place"],
          "description": "Layout type"
        },
        "parent": {
          "type": "string",
          "description": "Parent widget ID"
        },
        "options": {
          "oneOf": [
            { "$ref": "#/definitions/pack_options" },
            { "$ref": "#/definitions/grid_options" },
            { "$ref": "#/definitions/place_options" }
          ]
        }
      }
    },
    "pack_options": {
      "type": "object",
      "properties": {
        "side": {
          "type": "string",
          "enum": ["top", "bottom", "left", "right"],
          "description": "Side to place widget"
        },
        "fill": {
          "type": "string",
          "enum": ["none", "x", "y", "both"],
          "description": "Fill direction"
        },
        "expand": {
          "type": "boolean",
          "description": "Expand to fill available space"
        },
        "anchor": {
          "type": "string",
          "enum": ["n", "s", "e", "w", "ne", "nw", "se", "sw", "center"],
          "description": "Anchor position"
        },
        "padx": {
          "type": "integer",
          "description": "Horizontal padding"
        },
        "pady": {
          "type": "integer",
          "description": "Vertical padding"
        }
      }
    },
    "grid_options": {
      "type": "object",
      "properties": {
        "row": {
          "type": "integer",
          "minimum": 0,
          "description": "Row number"
        },
        "column": {
          "type": "integer",
          "minimum": 0,
          "description": "Column number"
        },
        "rowspan": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of rows to span"
        },
        "columnspan": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of columns to span"
        },
        "sticky": {
          "type": "string",
          "pattern": "^[nsew]+$",
          "description": "Sticky positioning (combination of n, s, e, w)"
        }
      }
    },
    "place_options": {
      "type": "object",
      "properties": {
        "x": {
          "type": "integer",
          "description": "X position"
        },
        "y": {
          "type": "integer",
          "description": "Y position"
        },
        "width": {
          "type": "integer",
          "minimum": 1,
          "description": "Width"
        },
        "height": {
          "type": "integer",
          "minimum": 1,
          "description": "Height"
        },
        "anchor": {
          "type": "string",
          "enum": ["n", "s", "e", "w", "ne", "nw", "se", "sw", "center"],
          "description": "Anchor position"
        }
      }
    },
    "handler": {
      "type": "object",
      "required": ["id", "event_type"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique handler identifier"
        },
        "event_type": {
          "type": "string",
          "description": "Event type (click, change, etc.)"
        },
        "widget_id": {
          "type": "string",
          "description": "Associated widget ID"
        },
        "implementations": {
          "type": "object",
          "description": "Language-specific implementations",
          "additionalProperties": {
            "type": "string",
            "description": "Handler code in target language"
          }
        }
      }
    },
    "data_binding": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Binding identifier"
        },
        "widget_id": {
          "type": "string",
          "description": "Widget ID"
        },
        "property": {
          "type": "string",
          "description": "Property to bind"
        },
        "source": {
          "type": "string",
          "description": "Data source (variable, expression, etc.)"
        }
      }
    }
  }
}
