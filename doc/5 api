CONTROLLER API

Kryon provides a file-based interface for UI manipulation. Any language 
capable of performing 9P2000 file operations (open, read, write) can 
control the window manager.

C API (via lib9pclient):

    #include <9p.h>
    #include <kryon.h>

    // Connect to Marrow Substrate
    CFid *fd = p9_connect("tcp!localhost!17010");

    // Mount Kryon service to /wm
    p9_mount(fd, "/srv/kryon", "/wm");

    // Create window via JSON write to ctl
    int ctl = p9_open(fd, "/wm/ctl", OWRITE);
    p9_write(fd, ctl, "{\"title\":\"My App\", \"w\":800, \"h\":600}", 38);
    p9_close(fd, ctl);

    // Set a property (recursive win/ path)
    int title = p9_open(fd, "/wm/win/1/title", OWRITE);
    p9_write(fd, title, "Updated Title", 13);
    p9_close(fd, title);

    // Blocking Event Loop
    int ev = p9_open(fd, "/wm/win/1/events", OREAD);
    char buf[256];
    while(p9_read(fd, ev, buf, sizeof(buf)) > 0) {
        printf("System Event: %s\n", buf);
    }



Shell (rc) Scripting:

    # Create top-level window
    echo '{"title":"ShellApp"}' > /wm/ctl

    # Set title using recursive path
    echo "Marrow Terminal" > /wm/win/1/title

    # Create a button widget
    echo "type=button" > /wm/win/1/widgets/new

    # Update widget property
    echo "Action" > /wm/win/1/widgets/1/text

    # Simple event listener
    while() {
        event = `{cat /wm/win/1/widgets/1/events}
        if (~ $event clicked*) {
            echo "Button was pressed!"
        }
    }

Python (via p9 library):

    import p9

    # Connect to the Marrow node
    marrow = p9.connect("tcp!localhost!17010")

    # Create window
    marrow.write("/wm/ctl", '{"title":"PyWin"}')

    # Create a nested window inside win 1
    marrow.write("/wm/win/1/win/new", '{"title":"SubWindow"}')

    # Add a checkbox to the subwindow
    marrow.write("/wm/win/1/win/2/widgets/new", "type=checkbox")
    marrow.write("/wm/win/1/win/2/widgets/1/text", "Enable AI")

    # Event generator
    for event in marrow.listen("/wm/win/1/win/2/widgets/1/events"):
        if "changed" in event:
            print("AI Status toggled")



Lua (Kryon-Native Scripting):

    local p9 = require("9p")
    local m = p9.connect("tcp!localhost!17010")

    -- Create Window
    m:write("/wm/ctl", '{"title":"LuaApp"}')

    -- Set Mode to TTY for serial-link optimization
    m:write("/wm/mode", "tty")

    -- Add a button
    m:write("/wm/win/1/widgets/new", "type=button")
    m:write("/wm/win/1/widgets/1/text", "Press Me")

    -- Event loop
    for ev in m:events("/wm/win/1/widgets/1/events") do
        if ev:find("clicked") then
            print("Input detected on /wm/win/1/widgets/1")
        end
    end

NOTES:

- Pathing: Always use `/wm/win/[id]` for windows and `/widgets/[id]` for leaf nodes.
- Recursion: Windows can be nested: `/wm/win/1/win/2/win/3/...`
- Mode Switch: Writing "tty" or "display" to `/wm/mode` changes the renderer instantly.
- Portability: Scripts written for Display mode work perfectly in TTY mode without changes.