CONTROLLER API

Kryon provides multiple ways to interact with the window manager filesystem.

C API (via Marrow client library):

    #include <marrow_client.h>
    #include <kryon.h>

    // Connect to Marrow
    P9Client *mc = marrow_connect("localhost", 17010);
    marrow_authenticate(mc, "none", "");

    // Register as window-manager service
    marrow_service_register(mc, "kryon", "window-manager",
                           "Kryon Window Manager");

    // Mount /mnt/wm to Marrow's namespace
    marrow_namespace_mount(mc, "/mnt/wm");

    // Open /dev/draw for rendering
    DrawClient *dc = drawclient_connect(mc);

    // Create window via filesystem
    int ctl_fd = marrow_open(mc, "/mnt/wm/ctl", O_WRONLY);
    write(ctl_fd, "{\"title\":\"My Window\",\"width\":800,\"height\":600}", 40);
    close(ctl_fd);

    // Set properties
    int title_fd = marrow_open(mc, "/mnt/wm/windows/1/title", O_WRONLY);
    write(title_fd, "New Title", 10);
    close(title_fd);

    // Event loop
    int event_fd = marrow_open(mc, "/mnt/wm/windows/1/events", O_RDONLY);
    char buf[256];
    while (read(event_fd, buf, sizeof(buf)) > 0) {
        printf("Event: %s\n", buf);
    }

Shell (rc) scripting:

    # Create window (via Marrow namespace)
    echo '{"title":"My Window","width":800,"height":600}' > /mnt/wm/ctl

    # Set title
    echo "New Title" > /mnt/wm/windows/1/title

    # Create button widget
    echo "type=button" > /mnt/wm/windows/1/widgets/new

    # Set button text
    echo "Click Me" > /mnt/wm/windows/1/widgets/1/properties/text

    # Event loop
    while () {
        event=`{cat /mnt/wm/windows/1/widgets/1/events}
        if (~ $event()) {
            echo Button clicked!
        }
    }

Python (via 9p client to Marrow):

    import p9

    # Connect to Marrow
    marrow = p9.mount("tcp!localhost!17010", "")

    # Access Kryon's /mnt/wm
    wm = marrow.cd("/mnt/wm")

    # Create window
    wm.ctl.write('{"title":"My Window","width":800,"height":600}')

    # Set title
    marrow.write("/mnt/wm/windows/1/title", "New Title")

    # Create button
    marrow.write("/mnt/wm/windows/1/widgets/new", "type=button")

    # Set text
    marrow.write("/mnt/wm/windows/1/widgets/1/properties/text", "Click Me")

    # Event loop
    for event in marrow.events("/mnt/wm/windows/1/widgets/1/events"):
        if "clicked" in event:
            print("Clicked!")

Lua (via 9p client to Marrow):

    local p9 = require("9p")

    -- Connect to Marrow
    local marrow = p9.connect("tcp!localhost!17010")

    -- Access Kryon's /mnt/wm
    local wm = marrow:cd("/mnt/wm")

    -- Create window
    wm:ctl_write('{"title":"My Window","width":800,"height":600}')

    -- Set title
    marrow:write("/mnt/wm/windows/1/title", "New Title")

    -- Create button
    marrow:write("/mnt/wm/windows/1/widgets/new", "type=button")

    -- Set text
    marrow:write("/mnt/wm/windows/1/widgets/1/properties/text", "Click Me")

    -- Event loop
    for event in marrow:events("/mnt/wm/windows/1/widgets/1/events") do
        if event:find("clicked") then
            print("Clicked!")
        end
    end

NOTES:

- All operations go through Marrow on port 17010
- /dev/draw is used for rendering (provided by Marrow)
- /mnt/wm is provided by Kryon service
- Window and widget properties are files in /mnt/wm
- Events are read from event files
