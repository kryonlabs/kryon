/**
 * @file main.c
 * @brief Kryon CLI Main Entry Point
 */

#include <lib9.h>
 
 #define KRYON_VERSION "alpha"
 
 extern int compile_command(int argc, char *argv[]);
 extern int decompile_command(int argc, char *argv[]);
 extern int print_command(int argc, char *argv[]);
 extern int kir_dump_command(int argc, char *argv[]);
 extern int kir_validate_command(int argc, char *argv[]);
 extern int kir_stats_command(int argc, char *argv[]);
 extern int kir_diff_command(int argc, char *argv[]);
 extern int run_command(int argc, char *argv[]);
 extern int dev_command(int argc, char *argv[]);
 extern int debug_command(int argc, char *argv[]);
 extern int package_command(int argc, char *argv[]);
 
 static void print_usage(const char *program_name) {
     print("Kryon-C %s - Complete UI Framework\n", KRYON_VERSION);
     print("Usage: %s <command> [options] [arguments]\n\n", program_name);
     print("Commands:\n");
     print("  compile <file.kry>     Compile KRY file to KRB binary\n");
     print("  decompile <file.krb>   Decompile KRB binary to KIR format\n");
     print("  print <file.kir>       Generate readable .kry source from KIR\n");
     print("  run <file.krb>         Run KRB application\n");
     print("  dev <file.kry>         Development mode with hot reload\n");
     print("  debug <file.krb>       Debug KRB application\n");
     print("  package <project>      Package for distribution\n");
     print("\n");
     print("KIR Utilities:\n");
     print("  kir-dump <file.kir>    Pretty-print KIR structure\n");
     print("  kir-validate <file>    Validate KIR file structure\n");
     print("  kir-stats <file>       Show KIR statistics\n");
     print("  kir-diff <f1> <f2>     Compare two KIR files\n");
     print("  --help, -h             Show this help message\n");
     print("  --version, -v          Show version information\n\n");
     print("Examples:\n");
     print("  %s compile hello-world.kry\n", program_name);
     print("  %s run hello-world.krb\n", program_name);
     print("  %s dev hello-world.kry --renderer=sdl2\n", program_name);
 }
 
 static void print_version(void) {
     print("Kryon-C %s\n", KRYON_VERSION);
     print("Platform: %s\n",
 #ifdef __linux__
            "Linux"
 #elif defined(__APPLE__)
            "macOS"
 #elif defined(_WIN32)
            "Windows"
 #elif defined(EMSCRIPTEN)
            "Web"
 #else
            "Unknown"
 #endif
     );
     print("Built: %s %s\n", __DATE__, __TIME__);
 }
 
 void main(int argc, char *argv[]) {
     if (argc < 2) {
         print_usage(argv[0]);
         exits("error");
     }
 
     const char *command = argv[1];
 
     if (strcmp(command, "--help") == 0 || strcmp(command, "-h") == 0) {
         print_usage(argv[0]);
         exits(nil);
     }
 
     if (strcmp(command, "--version") == 0 || strcmp(command, "-v") == 0) {
         print_version();
         exits(nil);
     }
 
     if (strcmp(command, "compile") == 0) {
         compile_command; exits(argc - 1, argv + 1);
    } else if (strcmp(command, "decompile") == 0) {
        decompile_command; exits(argc - 1, argv + 1);
    } else if (strcmp(command, "print") == 0) {
        print_command; exits(argc - 1, argv + 1);
    } else if (strcmp(command, "kir-dump") == 0) {
        kir_dump_command; exits(argc - 1, argv + 1);
    } else if (strcmp(command, "kir-validate") == 0) {
        kir_validate_command; exits(argc - 1, argv + 1);
    } else if (strcmp(command, "kir-stats") == 0) {
        kir_stats_command; exits(argc - 1, argv + 1);
    } else if (strcmp(command, "kir-diff") == 0) {
        kir_diff_command; exits(argc - 1, argv + 1);
     } else if (strcmp(command, "run") == 0) {
         run_command; exits(argc - 1, argv + 1);
     } else if (strcmp(command, "dev") == 0) {
         dev_command; exits(argc - 1, argv + 1);
     } else if (strcmp(command, "debug") == 0) {
         debug_command; exits(argc - 1, argv + 1);
     } else if (strcmp(command, "package") == 0) {
         package_command; exits(argc - 1, argv + 1);
     } else {
         fprint(2, "Unknown command: %s\n", command);
         print_usage(argv[0]);
         exits("error");
     }
 }
 