#!/bin/bash

# Simple test runner for Kryon-C

set -e

PROJECT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
BUILD_DIR="$PROJECT_ROOT/build"

echo "Building and running tests..."

mkdir -p "$BUILD_DIR"
cd "$BUILD_DIR"

cmake .. -DCMAKE_BUILD_TYPE=Debug -DBUILD_TESTS=ON
make -j$(nproc)

# Run tests
if command -v ctest &> /dev/null; then
    ctest --output-on-failure
else
    echo "Running test executables..."
    find . -name "*test*" -type f -executable -exec {} \;
fi

echo "Tests complete!"